<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MAR للمحاسبة</title>
    <script>
document.addEventListener('contextmenu', function(e) {
  e.preventDefault();
  alert('غير مسموح بهذا الإجراء');
});
</script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f9;
      }
      .password-container,
      .load-data-container {
        max-width: 400px;
        margin: 100px auto;
        background: #fff;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        text-align: center;
      }
      .password-container input,
      .load-data-container input {
        width: 100%;
        padding: 12px;
        margin: 15px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }
      .password-container button,
      .load-data-container button {
        width: 100%;
        padding: 12px;
        margin: 10px 0;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }
      .password-container button:hover,
      .load-data-container button:hover {
        background-color: #218838;
      }
      .load-data-container .btn-group {
        display: flex;
        gap: 10px;
      }
      .load-data-container .btn-group button {
        flex: 1;
      }
      .load-data-container .btn-group .cancel-btn {
        background-color: #dc3545;
      }
      .load-data-container .btn-group .cancel-btn:hover {
        background-color: #c82333;
      }
      .copyright {
        position: fixed;
        bottom: 0;
        width: 100%;
        background-color: #333;
        color: white;
        text-align: center;
        padding: 10px 0;
        font-size: 14px;
      }
      .hidden {
        display: none;
      }
      .container {
        max-width: 1000px;
        margin: 20px auto;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      h1,
      h2 {
        text-align: center;
        color: #333;
      }
      .form-group {
        margin-bottom: 15px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        color: #555;
      }
      input[type="text"],
      input[type="number"],
      input[type="search"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
      }
      .add-btn {
        background-color: #28a745;
      }
      .add-btn:hover {
        background-color: #218838;
      }
      .edit-btn {
        background-color: #ffc107;
        color: black;
      }
      .edit-btn:hover {
        background-color: #e0a800;
      }
      .delete-btn {
        background-color: #dc3545;
      }
      .delete-btn:hover {
        background-color: #c82333;
      }
      .nav-btn {
        background-color: #007bff;
      }
      .nav-btn:hover {
        background-color: #0069d9;
      }
      .save-btn {
        background-color: #6c757d;
      }
      .save-btn:hover {
        background-color: #5a6268;
      }
      .search-btn {
        background-color: #17a2b8;
      }
      .search-btn:hover {
        background-color: #138496;
      }
      .profit-btn {
        background-color: #6610f2;
      }
      .profit-btn:hover {
        background-color: #560ac0;
      }
      table {
        width: 100%;
        margin-top: 20px;
        border-collapse: collapse;
        overflow-x: auto;
      }
      table,
      th,
      td {
        border: 1px solid #ddd;
      }
      th,
      td {
        padding: 10px;
        text-align: center;
      }
      th {
        background-color: #f8f9fa;
        position: sticky;
        top: 0;
      }
      .current-rate {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 4px;
        margin-bottom: 15px;
        text-align: center;
        font-weight: bold;
      }
      .action-buttons {
        margin-top: 20px;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 10px;
      }
      .search-container {
        display: flex;
        margin-bottom: 15px;
      }
      .search-container input {
        flex: 1;
        margin-right: 10px;
      }
      .profit-positive {
        color: #28a745;
        font-weight: bold;
      }
      .profit-negative {
        color: #dc3545;
        font-weight: bold;
      }
      .table-container {
        max-height: 500px;
        overflow-y: auto;
        margin-bottom: 20px;
      }
      .action-cell {
        display: flex;
        gap: 5px;
        justify-content: center;
      }
      @media (max-width: 768px) {
        .container {
          padding: 10px;
        }
        .action-buttons {
          flex-direction: column;
        }
        button {
          width: 100%;
          margin: 5px 0;
        }
        .action-cell {
          flex-direction: column;
        }
      }
      .sell-btn {
        background-color: #17a2b8;
        margin-left: 5px;
      }

      .sell-btn:hover {
        background-color: #138496;
      }
        /* إضافة الخطوط */
      @import url("https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap");

      body {
        font-family: "Tajawal", Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #f4f4f9 0%, #e6f7ff 100%);
        color: #333;
        line-height: 1.8;
      }

      .container {
        max-width: 1000px;
        margin: 30px auto;
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      }

      .help-header {
        text-align: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 3px solid #28a745;
      }

      .help-header h1 {
        color: #2c3e50;
        font-size: 2.5rem;
        margin-bottom: 15px;
      }

      .help-header p {
        font-size: 1.2rem;
        color: #555;
        max-width: 800px;
        margin: 0 auto;
      }

      .feature-section {
        margin-bottom: 50px;
        padding: 25px;
        border-radius: 12px;
        background: #f9f9f9;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        transition: transform 0.3s ease;
      }

      .feature-section:hover {
        transform: translateY(-5px);
      }

      .section-title {
        display: flex;
        align-items: center;
        color: #28a745;
        font-size: 1.8rem;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px dashed #ddd;
      }

      .section-title span {
        margin-left: 15px;
        font-size: 1.5em;
      }

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 25px;
        margin-top: 20px;
      }

      .feature-card {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #28a745;
        transition: all 0.3s ease;
      }

      .feature-card:hover {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #218838;
      }

      .feature-card h3 {
        color: #2c3e50;
        margin-top: 0;
        display: flex;
        align-items: center;
      }

      .feature-card h3 span {
        margin-left: 10px;
        font-size: 1.3em;
      }

      .step-list {
        padding-right: 20px;
      }

      .step-list li {
        margin-bottom: 15px;
        position: relative;
        padding-right: 30px;
      }

      .step-list li:before {
        content: "→";
        position: absolute;
        right: 0;
        top: 0;
        color: #28a745;
        font-weight: bold;
      }

      .screenshot {
        max-width: 100%;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin: 20px 0;
        border: 1px solid #eee;
      }

      .action-buttons {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 40px;
      }

      .btn {
        padding: 14px 30px;
        background: #28a745;
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        text-decoration: none;
      }

      .btn span {
        margin-left: 10px;
        font-size: 1.2em;
      }

      .btn:hover {
        background: #218838;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .btn-secondary {
        background: #007bff;
      }

      .btn-secondary:hover {
        background: #0069d9;
      }

      .highlight {
        background: #e6ffe6;
        padding: 3px 8px;
        border-radius: 5px;
        font-weight: bold;
        color: #218838;
        border: 1px solid #c3e6cb;
      }

      .tip-box {
        background: #e8f4fc;
        border-left: 4px solid #007bff;
        padding: 20px;
        border-radius: 5px;
        margin: 25px 0;
      }

      .tip-box h4 {
        margin-top: 0;
        color: #007bff;
        display: flex;
        align-items: center;
      }

      .tip-box h4 span {
        margin-left: 10px;
      }

      .support-section {
        text-align: center;
        padding: 40px;
        background: #f8f9fa;
        border-radius: 15px;
        margin-top: 50px;
      }

      .support-section h2 {
        color: #2c3e50;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
        }

        .section-title {
          font-size: 1.5rem;
        }

        .feature-grid {
          grid-template-columns: 1fr;
        }

        .action-buttons {
          flex-direction: column;
          gap: 15px;
        }

        .btn {
          width: 100%;
          justify-content: center;
        }
      }
      /* تصميم عداد الزوار قبل الدخول */
.pre-login-counter {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background: rgba(255, 255, 255, 0.9);
  padding: 12px 20px;
  border-radius: 30px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  gap: 10px;
  font-family: 'Tajawal', sans-serif;
  z-index: 1000;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(0, 0, 0, 0.05);
}

.counter-icon {
  font-size: 24px;
  background: #28a745;
  color: white;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.counter-text {
  font-size: 14px;
  color: #333;
}

.counter-text span {
  font-weight: bold;
  color: #28a745;
  font-size: 16px;
}

@media (max-width: 768px) {
  .pre-login-counter {
    bottom: 10px;
    left: 10px;
    right: 10px;
    justify-content: center;
  }
}
/* تأثير الطفو للعداد */
.pre-login-counter {
  transition: all 0.3s ease;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}
/* تأثير النبض */
@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.counter-icon {
  animation: pulse 2s infinite;
}
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  </head>
  <body>
    <!-- صفحة المساعدة -->
<div id="helpPage" class="hidden">
    <div class="container">
        <div class="help-header">
            <h1>🚀 شرح تفصيلي لنظام MAR للمحاسبة</h1>
            <p>اكتشف كيف يمكنك إدارة متجرك بكل سهولة واحترافية مع نظامنا المتكامل!</p>
        </div>
         <div class="feature-section">
            <h2 class="section-title"><span>📱</span> شاشة الدخول</h2>
            <p>لحماية بياناتك، يبدأ النظام بشاشة دخول آمنة:</p>
           
            <div class="feature-card">
                <h3><span>🔑</span> كلمة المرور</h3>
                <p>أدخل كلمة المرور  <span class="highlight"></span> للوصول إلى النظام .</p>
            </div>
           
            <div class="feature-card">
                <h3><span>🆘</span> الدعم الفني</h3>
                <p>اضغط على زر <span class="highlight">الدعم</span> للتواصل مع فريق الدعم عبر التليجرام عند الحاجة.</p>
            </div>
        </div>
       
        <div class="feature-section">
            <h2 class="section-title"><span>🚦</span> بدء المشروع</h2>
            <p>اختر الطريقة التي تريد البدء بها:</p>
           
            <div class="feature-grid">
                <div class="feature-card">
                    <h3><span>📂</span> تحميل المحفوظات</h3>
                    <p>استخدم هذا الخيار لاستعادة جميع بياناتك السابقة في حال كنت قد استخدمت النظام من قبل.</p>
                </div>
               
                <div class="feature-card">
                    <h3><span>✨</span> مشروع جديد</h3>
                    <p>ابدأ من الصفر بإدخال منتجاتك وأسعارك الجديدة (سيؤدي هذا إلى حذف أي بيانات سابقة).</p>
                </div>
            </div>
        </div>
       
        <div class="feature-section">
            <h2 class="section-title"><span>🛍️</span> إضافة المنتجات</h2>
            <p>هذه الشاشة الرئيسية لإدارة منتجاتك:</p>
           
            <ol class="step-list">
                <li><span class="highlight">💱 سعر الصرف</span>: أدخل سعر صرف الدولار بالليرة السورية (سيتم تأمينه بعد الإدخال الأول)</li>
                <li><span class="highlight">🏷️ اسم المنتج</span>: أدخل اسم المنتج كما تريده</li>
                <li><span class="highlight">💰 سعر الشراء</span>: تكلفة المنتج بالليرة السورية</li>
                <li><span class="highlight">🏷️ سعر البيع</span>: السعر الذي ستقوم ببيع المنتج به بالليرة</li>
                <li><span class="highlight">📦 الكمية</span>: عدد القطع المتوفرة من هذا المنتج</li>
            </ol>
           
            <div class="tip-box">
                <h4><span>💡</span> نصيحة مهمة</h4>
                <p>بعد إدخال المنتج الأول، لن تتمكن من تغيير سعر الصرف إلا من خلال شاشة البيع أو شاشة الأرباح للحفاظ على دقة الحسابات.</p>
            </div>
        </div>
       
        <div class="feature-section">
            <h2 class="section-title"><span>📊</span> شاشة البيع</h2>
            <p>هنا يمكنك إدارة عملية البيع ومتابعة منتجاتك:</p>
           
            <div class="feature-grid">
                <div class="feature-card">
                    <h3><span>🔍</span> البحث</h3>
                    <p>ابحث عن أي منتج بالاسم للعثور عليه بسرعة في قائمتك الطويلة.</p>
                </div>
               
                <div class="feature-card">
                    <h3><span>🔄</span> تعديل سعر الصرف</h3>
                    <p>اضغط على زر <span class="highlight">تعديل</span> بجانب سعر الصرف لتحديثه إذا تغير.</p>
                </div>
               
                <div class="feature-card">
                    <h3><span>🛒</span> بيع المنتجات</h3>
                    <p>اضغط على <span class="highlight">بيع قطعة</span> لتسجيل عملية بيع وتحديث الكمية المتبقية تلقائياً.</p>
                </div>
               
                <div class="feature-card">
                    <h3><span>✏️</span> التعديل والحذف</h3>
                    <p>يمكنك تعديل أي منتج أو حذفه بضغطة زر عند الحاجة.</p>
                </div>
            </div>
        </div>
       
        <div class="feature-section">
            <h2 class="section-title"><span>💹</span> شاشة الأرباح</h2>
            <p>اكتشف أرباحك من كل منتج وإجمالي أرباحك:</p>
           
            <div class="feature-grid">
                <div class="feature-card">
                    <h3><span>📈</span> ربح لكل منتج</h3>
                    <p>شاهد ربحك من كل منتج بالليرة السورية والدولار معاً.</p>
                </div>
               
                <div class="feature-card">
                    <h3><span>🎨</span> تمييز الألوان</h3>
                    <p>الأرباح الإيجابية تظهر <span style="color:#28a745; font-weight:bold">باللون الأخضر</span> والخسائر تظهر <span style="color:#dc3545; font-weight:bold">باللون الأحمر</span>.</p>
                </div>
               
                <div class="feature-card">
                    <h3><span>🧮</span> الإجمالي</h3>
                    <p>النظام يحسب لك تلقائياً مجموع الأرباح بالليرة والدولار في أسفل الجدول.</p>
                </div>
            </div>
        </div>
       
        <div class="feature-section">
            <h2 class="section-title"><span>💾</span> الحفظ والتصدير</h2>
            <p>حافظ على بياناتك واستخرج تقاريرك بسهولة:</p>
           
            <div class="feature-grid">
                <div class="feature-card">
                    <h3><span>💾</span> حفظ البيانات</h3>
                    <p>اضغط على زر <span class="highlight">حفظ البيانات</span> لحفظ كل ما أدخلته على جهازك.</p>
                </div>
               
                <div class="feature-card">
                    <h3><span>📥</span> التصدير إلى Excel</h3>
                    <p>استخرج تقريراً كاملاً بجميع منتجاتك وأرباحك بصيغة Excel.</p>
                </div>
               
                <div class="feature-card">
                    <h3><span>🔄</span> التحميل التلقائي</h3>
                    <p>عند زيارتك القادمة للنظام، ستجد كل بياناتك كما تركها.</p>
                </div>
            </div>
        </div>
       
        <div class="support-section">
            <h2><span>🆘</span> بحاجة إلى مساعدة؟</h2>
            <p>فريق الدعم جاهز للإجابة على أي استفسار لديك</p>
           
            <div class="action-buttons">
                <a href="https://t.me/mar01abdullah" class="btn btn-secondary">
                    <span>💬</span> تواصل مع الدعم عبر التليجرام
                </a>
                <button class="btn" onclick="hideHelpPage()">
    <span>🔙</span> العودة للنظام
</button>
            </div>
        </div>
    </div>

        <div class="action-buttons">
            <button class="btn" onclick="hideHelpPage()">
                <span>🔙</span> العودة للنظام
            </button>
        </div>
    </div>
</div>
    <!-- شاشة إدخال كلمة المرور -->
    <div id="passwordScreen">
      <div class="password-container">
        <h2>مرحباً بكم في نظام MAR للمحاسبة</h2>
        <p>الرجاء إدخال كلمة المرور للدخول:</p>
        <p>
          <a href="https://t.me/mar01abdullah" title="التواصل مع المطور "
            ><button>الدعم</button></a
          >
        </p>
        <input type="password" id="passwordInput" placeholder="كلمة المرور" />
        <button onclick="checkPassword()">دخول</button>
        <button
          onclick="showHelpPage()"
          style="
            margin-top: 10px;
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
          "
        >
          شرح استخدام النظام
        </button>
        <p id="errorMsg" style="color: red; display: none">
          كلمة المرور غير صحيحة، يرجى المحاولة مرة أخرى
        </p>
      </div>
      <!-- عداد الزوار -->
<div class="pre-login-counter">
  <div class="counter-icon">👥</div>
  <div class="counter-text">
    <span id="preLoginCounter">0</span> زائر يستخدم النظام حالياً
  </div>
</div>
    </div>

    <!-- شاشة تحميل البيانات -->
    <div id="loadDataScreen" class="hidden">
      <div class="load-data-container">
        <h2>تحميل البيانات</h2>
        <p>هل تريد تحميل البيانات المحفوظة سابقاً أو البدء بمشروع جديد؟</p>
        <div class="btn-group">
          <button onclick="loadSavedData()">تحميل المحفوظات</button>
          <button onclick="startNewProject()">مشروع جديد</button>
        </div>
        <div class="btn-group">
          <button class="cancel-btn" onclick="backToPasswordScreen()">
            العودة
          </button>
        </div>
      </div>
    </div>

    <!-- المحتوى الرئيسي -->
    <div id="mainContent" class="hidden">
      <h1>MAR للمحاسبة</h1>

      <!-- الواجهة الأولى: إضافة المنتجات -->
      <div class="container" id="inputPage">
        <h2>إضافة منتجات</h2>

        <div class="form-group">
          <label for="exchangeRate"
            >سعر صرف الدولار (ليرة سورية لكل دولار)</label
          >
          <input
            type="number"
            id="exchangeRate"
            placeholder="أدخل سعر الصرف"
            step="0.0001"
            min="0.0001"
          />
        </div>

        <div class="form-group">
          <label for="productName">اسم المنتج</label>
          <input type="text" id="productName" placeholder="أدخل اسم المنتج" />
        </div>

        <div class="form-group">
          <label for="buyPrice">سعر الشراء (ليرة سورية)</label>
          <input
            type="number"
            id="buyPrice"
            placeholder="أدخل سعر الشراء"
            step="0.01"
            min="0.01"
          />
        </div>

        <div class="form-group">
          <label for="sellPrice">سعر البيع (ليرة سورية)</label>
          <input
            type="number"
            id="sellPrice"
            placeholder="أدخل سعر البيع"
            step="0.01"
            min="0.01"
          />
        </div>

        <div class="form-group">
          <label for="productQuantity">عدد القطع</label>
          <input
            type="number"
            id="productQuantity"
            placeholder="أدخل عدد القطع"
            step="1"
            min="1"
            value="1"
          />
        </div>

        <div class="action-buttons">
          <button class="add-btn" onclick="addProduct()">إضافة منتج</button>
          <button class="nav-btn" onclick="showOutputPage()">
            عرض قائمة البيع
          </button>
          <button class="profit-btn" onclick="showProfitPage()">
            عرض الأرباح
          </button>
          <button class="save-btn" onclick="saveData()">حفظ البيانات</button>
          <button class="nav-btn" onclick="exportToExcel()">
            تصدير كـ Excel
          </button>
        </div>
      </div>

      <!-- الواجهة الثانية: قائمة البيع -->
      <div class="container hidden" id="outputPage">
        <h2>قائمة أسعار البيع</h2>

        <div class="current-rate">
          سعر الصرف الحالي: <span id="currentRateDisplay"></span> ليرة سورية لكل
          دولار
          <button
            class="edit-btn"
            onclick="editExchangeRate()"
            style="margin-left: 10px"
          >
            تعديل
          </button>
        </div>

        <div class="search-container">
          <input
            type="search"
            id="searchInput"
            placeholder="ابحث عن منتج..."
            onkeyup="searchProduct()"
          />
          <button class="search-btn" onclick="searchProduct()">بحث</button>
        </div>

        <div class="table-container">
          <table id="productsTable">
            <thead>
              <tr>
                <th>اسم المنتج</th>
                <th>سعر الشراء (ليرة)</th>
                <th>سعر البيع (ليرة)</th>
                <th>سعر البيع ($)</th>
                <th>إجراءات</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="action-buttons">
          <button class="nav-btn" onclick="backToInputPage()">
            العودة للإضافة
          </button>
          <button class="profit-btn" onclick="showProfitPage()">
            عرض الأرباح
          </button>
        </div>
      </div>

      <!-- الواجهة الثالثة: حساب الأرباح -->
      <div class="container hidden" id="profitPage">
        <h2>حساب الأرباح للمنتجات</h2>

        <div class="current-rate">
          سعر الصرف الحالي: <span id="profitRateDisplay"></span> ليرة سورية لكل
          دولار
          <button
            class="edit-btn"
            onclick="editExchangeRate()"
            style="margin-left: 10px"
          >
            تعديل
          </button>
        </div>

        <div class="table-container">
          <table id="profitTable">
            <thead>
              <tr>
                <th>اسم المنتج</th>
                <th>سعر الشراء (ليرة)</th>
                <th>سعر البيع (ليرة)</th>
                <th>الربح (ليرة)</th>
                <th>سعر الشراء ($)</th>
                <th>سعر البيع ($)</th>
                <th>الربح ($)</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot id="profitTotals" style="display: none">
              <tr>
                <th colspan="3">المجموع:</th>
                <td id="totalProfitLBP"></td>
                <td colspan="2"></td>
                <td id="totalProfitUSD"></td>
              </tr>
            </tfoot>
          </table>
        </div>

        <div class="action-buttons">
          <button class="nav-btn" onclick="backToInputPage()">
            العودة للإضافة
          </button>
          <button class="nav-btn" onclick="showOutputPage()">
            عرض قائمة البيع
          </button>
        </div>
      </div>

      <div class="copyright">
        جميع الحقوق محفوظة &copy; <span id="currentYear"></span> - شركة M_A_R -
        abdullah
      </div>
    </div>
    
    <script>
      // عداد الزوار قبل الدخول
function updatePreLoginCounter() {
  // البدء بقيمة عشوائية بين 50-150
  let count = localStorage.getItem('preLoginVisitors');
  if (!count) {
    count = Math.floor(Math.random() * 100) + 50;
  } else {
    count = parseInt(count);
    // زيادة عشوائية بين 1-5 كل 3 ثوان
    count += Math.floor(Math.random() * 5) + 1;
  }
  
  // تخزين القيمة
  localStorage.setItem('preLoginVisitors', count);
  
  // عرض القيمة مع فواصل للألوف
  document.getElementById('preLoginCounter').textContent = count.toLocaleString();
  
  // تحديث العداد كل 3 ثوان
  setTimeout(updatePreLoginCounter, 3000);
}

// بدء العداد عند تحميل الصفحة
window.addEventListener('load', function() {
  if (document.getElementById('passwordScreen').style.display !== 'none') {
    updatePreLoginCounter();
  }
});
      const correctPassword = "0986330544";
      const STORAGE_KEY = "mar_accounting_data";

      document.getElementById("currentYear").textContent =
        new Date().getFullYear();

      function checkPassword() {
        const enteredPassword = document
          .getElementById("passwordInput")
          .value.trim();
        const errorMsg = document.getElementById("errorMsg");
        if (enteredPassword === correctPassword) {
          document.getElementById("passwordScreen").style.display = "none";
          showLoadDataScreen();
        } else {
          errorMsg.style.display = "block";
          document.getElementById("passwordInput").value = "";
          document.getElementById("passwordInput").focus();
        }
      }

      function showLoadDataScreen() {
        document.getElementById("loadDataScreen").classList.remove("hidden");
      }

      function backToPasswordScreen() {
        document.getElementById("loadDataScreen").classList.add("hidden");
        document.getElementById("passwordScreen").style.display = "block";
        document.getElementById("passwordInput").value = "";
        document.getElementById("passwordInput").focus();
        document.getElementById("errorMsg").style.display = "none";
      }

      function loadSavedData() {
        document.getElementById("loadDataScreen").classList.add("hidden");
        document.getElementById("mainContent").classList.remove("hidden");
        loadData();
      }

      function startNewProject() {
        if (
          confirm(
            "هل أنت متأكد أنك تريد بدء مشروع جديد؟ سيتم مسح جميع البيانات المحفوظة."
          )
        ) {
          products = [];
          currentExchangeRate = null;
          document.getElementById("exchangeRate").value = "";
          document.getElementById("exchangeRate").readOnly = false;
          document.getElementById("loadDataScreen").classList.add("hidden");
          document.getElementById("mainContent").classList.remove("hidden");
          localStorage.removeItem(STORAGE_KEY);
          alert("تم بدء مشروع جديد بنجاح");
        }
      }

      document
        .getElementById("passwordInput")
        .addEventListener("keyup", function (event) {
          if (event.key === "Enter") checkPassword();
        });

      let products = [];
      let currentExchangeRate = null;

      function saveData() {
        if (!currentExchangeRate || currentExchangeRate <= 0) {
          alert("الرجاء إدخال سعر صرف صحيح أولاً");
          return;
        }

        if (products.length === 0) {
          alert("لا توجد منتجات لحفظها");
          return;
        }

        const dataToSave = {
          products: products,
          exchangeRate: currentExchangeRate,
          lastUpdated: new Date().toISOString(),
        };

        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
          alert("تم حفظ البيانات بنجاح على جهازك!");
        } catch (e) {
          alert("حدث خطأ أثناء محاولة حفظ البيانات: " + e.message);
        }
      }

      function loadData() {
        const savedData = localStorage.getItem(STORAGE_KEY);
        if (savedData) {
          try {
            const parsedData = JSON.parse(savedData);

            if (
              parsedData.products &&
              Array.isArray(parsedData.products) &&
              parsedData.exchangeRate &&
              !isNaN(parsedData.exchangeRate)
            ) {
              products = parsedData.products;
              currentExchangeRate = parseFloat(parsedData.exchangeRate);

              document.getElementById("exchangeRate").value =
                currentExchangeRate;
              document.getElementById("exchangeRate").readOnly = true;

              alert("تم تحميل " + products.length + " منتج بنجاح");
            } else {
              alert("بيانات غير صالحة، سيتم بدء مشروع جديد");
              startNewProject();
            }
          } catch (e) {
            alert("خطأ في تحميل البيانات: " + e.message);
            startNewProject();
          }
        } else {
          alert("لا توجد بيانات محفوظة، سيتم بدء مشروع جديد");
          startNewProject();
        }
      }

      function addProduct() {
        const productName = document.getElementById("productName").value.trim();
        const buyPrice = parseFloat(document.getElementById("buyPrice").value);
        const sellPrice = parseFloat(
          document.getElementById("sellPrice").value
        );
        const exchangeRateInput = parseFloat(
          document.getElementById("exchangeRate").value
        );
        const quantity = parseInt(
          document.getElementById("productQuantity").value
        );

        if (!productName) return alert("الرجاء إدخال اسم المنتج");
        if (isNaN(buyPrice)) return alert("سعر الشراء غير صحيح");
        if (isNaN(sellPrice)) return alert("سعر البيع غير صحيح");
        if (isNaN(exchangeRateInput)) return alert("سعر الصرف غير صحيح");
        if (isNaN(quantity) || quantity < 1) return alert("الكمية غير صحيحة");

        if (currentExchangeRate === null) {
          currentExchangeRate = exchangeRateInput;
          document.getElementById("exchangeRate").readOnly = true;
        }

        const buyPriceUSD = buyPrice / currentExchangeRate;
        const sellPriceUSD = sellPrice / currentExchangeRate;

        const product = {
          id: Date.now(),
          name: productName,
          buyPriceLBP: buyPrice,
          sellPriceLBP: sellPrice,
          buyPriceUSD: buyPriceUSD,
          sellPriceUSD: sellPriceUSD,
          profitLBP: sellPrice - buyPrice,
          profitUSD: sellPriceUSD - buyPriceUSD,
          quantity: quantity,
          soldQuantity: 0, // الكمية المباعة
          remainingQuantity: quantity, // الكمية المتبقية
          addedDate: new Date().toISOString(),
        };

        products.push(product);
        clearProductInputs();
        alert("تمت الإضافة بنجاح");
        saveData();
      }

      function showOutputPage() {
        if (!validateData()) return;
        document.getElementById("inputPage").classList.add("hidden");
        document.getElementById("profitPage").classList.add("hidden");
        document.getElementById("outputPage").classList.remove("hidden");
        document.getElementById("currentRateDisplay").textContent =
          currentExchangeRate.toFixed(4);
        renderProductsTable();
      }

      function showProfitPage() {
        if (!validateData()) return;
        document.getElementById("inputPage").classList.add("hidden");
        document.getElementById("outputPage").classList.add("hidden");
        document.getElementById("profitPage").classList.remove("hidden");
        document.getElementById("profitRateDisplay").textContent =
          currentExchangeRate.toFixed(4);
        renderProfitTable();
      }

      function renderProductsTable() {
        const tbody = document.querySelector("#productsTable tbody");
        tbody.innerHTML = "";

        products.forEach((product) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                                <td>${product.name}</td>
                                <td>${product.buyPriceLBP.toFixed(2)}</td>
                                <td>${product.sellPriceLBP.toFixed(2)}</td>
                                <td>$${product.sellPriceUSD.toFixed(2)}</td>
                                <td>
                                    <button class="sell-btn" onclick="sellProduct(${
                                      product.id
                                    }, 1)">بيع قطعة</button>
                                    <button onclick="editProduct(${
                                      product.id
                                    })">تعديل</button>
                                    <button onclick="deleteProduct(${
                                      product.id
                                    })">حذف</button>
                                </td>
                            `;
          tbody.appendChild(row);
        });
      }

      function renderProfitTable() {
        const tbody = document.querySelector("#profitTable tbody");
        const tfoot = document.getElementById("profitTotals");
        tbody.innerHTML = "";
        tfoot.style.display = "none";

        let totalLBP = 0;
        let totalUSD = 0;

        products.forEach((product) => {
          const lbpProfit = product.profitLBP * product.quantity;
          const usdProfit = product.profitUSD * product.quantity;
          totalLBP += lbpProfit;
          totalUSD += usdProfit;

          const row = document.createElement("tr");
          row.innerHTML = `
                                <td>${product.name} (${
            product.quantity
          } قطع)</td>
                                <td>${product.buyPriceLBP.toFixed(2)}</td>
                                <td>${product.sellPriceLBP.toFixed(2)}</td>
                                <td class="${
                                  lbpProfit >= 0
                                    ? "profit-positive"
                                    : "profit-negative"
                                }">${lbpProfit.toFixed(2)}</td>
                                <td>$${product.buyPriceUSD.toFixed(2)}</td>
                                <td>$${product.sellPriceUSD.toFixed(2)}</td>
                                <td class="${
                                  usdProfit >= 0
                                    ? "profit-positive"
                                    : "profit-negative"
                                }">$${usdProfit.toFixed(2)}</td>
                            `;
          tbody.appendChild(row);
        });

        if (products.length > 0) {
          tfoot.style.display = "";
          document.getElementById("totalProfitLBP").textContent =
            totalLBP.toFixed(2);
          document.getElementById(
            "totalProfitUSD"
          ).textContent = `$${totalUSD.toFixed(2)}`;
        }
      }

      function editProduct(productId) {
        const product = products.find((p) => p.id === productId);
        if (!product) return;

        const newName = prompt("الاسم الجديد:", product.name);
        if (!newName) return;

        const newBuyPrice = parseFloat(
          prompt("سعر الشراء الجديد:", product.buyPriceLBP)
        );
        if (isNaN(newBuyPrice)) return;

        const newSellPrice = parseFloat(
          prompt("سعر البيع الجديد:", product.sellPriceLBP)
        );
        if (isNaN(newSellPrice)) return;

        const newQuantity = parseInt(
          prompt("الكمية الجديدة:", product.quantity)
        );
        if (isNaN(newQuantity)) return;

        product.name = newName;
        product.buyPriceLBP = newBuyPrice;
        product.sellPriceLBP = newSellPrice;
        product.quantity = newQuantity;
        product.buyPriceUSD = newBuyPrice / currentExchangeRate;
        product.sellPriceUSD = newSellPrice / currentExchangeRate;
        product.profitLBP = newSellPrice - newBuyPrice;
        product.profitUSD = product.sellPriceUSD - product.buyPriceUSD;

        saveData();
        renderProductsTable();
        if (!document.getElementById("profitPage").classList.contains("hidden"))
          renderProfitTable();
        alert("تم التعديل بنجاح");
      }

      function deleteProduct(productId) {
        if (!confirm("تأكيد الحذف؟")) return;
        products = products.filter((p) => p.id !== productId);
        saveData();
        renderProductsTable();
        if (!document.getElementById("profitPage").classList.contains("hidden"))
          renderProfitTable();
        alert("تم الحذف");
      }

      function backToInputPage() {
        document.getElementById("outputPage").classList.add("hidden");
        document.getElementById("profitPage").classList.add("hidden");
        document.getElementById("inputPage").classList.remove("hidden");
      }

      function clearProductInputs() {
        document.getElementById("productName").value = "";
        document.getElementById("buyPrice").value = "";
        document.getElementById("sellPrice").value = "";
        document.getElementById("productQuantity").value = "1";
        document.getElementById("productName").focus();
      }

      document
        .getElementById("searchInput")
        .addEventListener("keyup", function (event) {
          if (event.key === "Enter") searchProduct();
        });

      function editExchangeRate() {
        const newRate = parseFloat(
          prompt("السعر الجديد:", currentExchangeRate)
        );
        // if (isNaN(newRate) return alert('قيمة غير صالحة');
        if (newRate <= 0) return alert("يجب أن يكون السعر أكبر من صفر");

        const rateChange = newRate / currentExchangeRate;
        currentExchangeRate = newRate;

        products.forEach((p) => {
          p.sellPriceLBP = p.sellPriceUSD * currentExchangeRate;
          p.buyPriceUSD = p.buyPriceLBP / currentExchangeRate;
          p.profitLBP = p.sellPriceLBP - p.buyPriceLBP;
          p.profitUSD = p.sellPriceUSD - p.buyPriceUSD;
        });

        document.getElementById("exchangeRate").value = currentExchangeRate;
        saveData();
        if (!document.getElementById("outputPage").classList.contains("hidden"))
          renderProductsTable();
        if (!document.getElementById("profitPage").classList.contains("hidden"))
          renderProfitTable();
        alert("تم تحديث سعر الصرف");
      }

      function validateData() {
        if (!currentExchangeRate) {
          alert("حدد سعر الصرف أولاً");
          return false;
        }
        if (products.length === 0) {
          alert("لا توجد منتجات");
          return false;
        }
        return true;
      }

      function searchProduct() {
        const term = document.getElementById("searchInput").value.toLowerCase();
        const filtered = term
          ? products.filter((p) => p.name.toLowerCase().includes(term))
          : products;

        const tbody = document.querySelector("#productsTable tbody");
        tbody.innerHTML = "";

        filtered.forEach((p) => {
          tbody.innerHTML += `
                                <tr>
                                    <td>${p.name}</td>
                                    <td>${p.buyPriceLBP.toFixed(2)}</td>
                                    <td>${p.sellPriceLBP.toFixed(2)}</td>
                                    <td>$${p.sellPriceUSD.toFixed(2)}</td>
                                    <td>
                                        <button onclick="editProduct(${
                                          p.id
                                        })">تعديل</button>
                                        <button onclick="deleteProduct(${
                                          p.id
                                        })">حذف</button>
                                    </td>
                                </tr>
                            `;
        });
      }
      function exportToExcel() {
        if (products.length === 0) {
          alert("لا توجد بيانات للتصدير!");
          return;
        }

        // حساب الأرباح والمجموع الكلي
        let totalProfitLBP = 0;
        let totalProfitUSD = 0;

        const wsData = [
          [
            "اسم المنتج",
            "الكمية",
            "المباع",
            "المتبقي",
            "سعر الشراء (ليرة)",
            "سعر البيع (ليرة)",
            "الربح (ليرة)",
            "الربح ($)",
          ],
          ...products.map((p) => {
            const profitLBP =
              (p.sellPriceLBP - p.buyPriceLBP) *
              (p.quantity - (p.remainingQuantity || 0));
            const profitUSD =
              (p.sellPriceUSD - p.buyPriceUSD) *
              (p.quantity - (p.remainingQuantity || 0));
            totalProfitLBP += profitLBP;
            totalProfitUSD += profitUSD;

            return [
              p.name,
              p.quantity,
              p.soldQuantity || 0,
              p.remainingQuantity || p.quantity,
              p.buyPriceLBP.toFixed(2),
              p.sellPriceLBP.toFixed(2),
              profitLBP.toFixed(2),
              profitUSD.toFixed(2),
            ];
          }),
          [], // سطر فارغ للفصل
          [
            "المجموع الكلي",
            "",
            "",
            "",
            "",
            "",
            totalProfitLBP.toFixed(2),
            totalProfitUSD.toFixed(2),
          ],
        ];

        // إنشاء ورقة العمل مع تنسيقات
        const ws = XLSX.utils.aoa_to_sheet(wsData);

        // تحديد عرض الأعمدة (اختياري)
        ws["!cols"] = [
          { wch: 30 }, // اسم المنتج
          { wch: 10 }, // الكمية
          { wch: 10 }, // المباع
          { wch: 10 }, // المتبقي
          { wch: 15 }, // سعر الشراء
          { wch: 15 }, // سعر البيع
          { wch: 15 }, // الربح (ليرة)
          { wch: 15 }, // الربح ($)
        ];

        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "المنتجات");

        // حفظ الملف
        XLSX.writeFile(wb, "كشف_البضائع_مع_الأرباح.xlsx");
      }
      function sellProduct(productId, quantityToSell) {
        const product = products.find((p) => p.id === productId);

        if (!product) return;

        if (product.remainingQuantity < quantityToSell) {
          alert("الكمية المتبقية غير كافية!");
          return;
        }

        // التحديث الصحيح
        product.soldQuantity = (product.soldQuantity || 0) + quantityToSell;
        product.remainingQuantity -= quantityToSell; // أفضل من: product.remainingQuantity - quantityToSell

        saveData();
        renderProductsTable();

        if (
          !document.getElementById("profitPage").classList.contains("hidden")
        ) {
          renderProfitTable();
        }

        alert("تم البيع بنجاح!");
      }
      // عرض صفحة المساعدة
function showHelpPage() {
    // تخزين حالة الواجهة الحالية قبل عرض المساعدة
    const fromPasswordScreen = document.getElementById("passwordScreen").style.display !== "none";
    
    // إخفاء كل الواجهات
    document.getElementById("passwordScreen").style.display = "none";
    document.getElementById("loadDataScreen").classList.add("hidden");
    document.getElementById("mainContent").classList.add("hidden");
    
    // إظهار صفحة المساعدة
    document.getElementById("helpPage").classList.remove("hidden");
    
    // تخزين المعلومات للعودة الصحيحة
    sessionStorage.setItem("returnToPassword", fromPasswordScreen);
}
// إخفاء صفحة المساعدة
function hideHelpPage() {
    // إخفاء صفحة المساعدة
    document.getElementById("helpPage").classList.add("hidden");
    
    // إعادة عرض الواجهة التي كان المستخدم عليها قبل الدخول للمساعدة
    if (document.getElementById("mainContent").classList.contains("hidden")) {
        // إذا كان المستخدم في شاشة الدخول
        document.getElementById("passwordScreen").style.display = "block";
    } else {
        // إذا كان المستخدم في الواجهة الرئيسية
        document.getElementById("mainContent").classList.remove("hidden");
        document.getElementById("inputPage").classList.remove("hidden");
    }
}

    </script>
    
  </body>
</html>
